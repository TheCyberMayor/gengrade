<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results - IntellGrade</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-graduation-cap me-2"></i>
                    IntellGrade - Result Management Test
                </h1>
                
                <div class="card">
                    <div class="card-header">
                        <h5>Test Result Management Features</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Test Manual Result Upload</h6>
                                <form id="testResultForm">
                                    <div class="mb-3">
                                        <label class="form-label">Student ID</label>
                                        <input type="text" class="form-control" id="testStudentId" value="STU001">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Student Name</label>
                                        <input type="text" class="form-control" id="testStudentName" value="Alice Johnson">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Course Code</label>
                                        <input type="text" class="form-control" id="testCourseCode" value="CSC101">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Course Title</label>
                                        <input type="text" class="form-control" id="testCourseTitle" value="Introduction to Computer Science">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Credit Units</label>
                                        <input type="number" class="form-control" id="testCreditUnits" value="3" min="1" max="6">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Score</label>
                                        <input type="number" class="form-control" id="testScore" value="85" min="0" max="100">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Semester</label>
                                        <input type="text" class="form-control" id="testSemester" value="2024/1">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Lecturer</label>
                                        <input type="text" class="form-control" id="testLecturer" value="Dr. John Smith">
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-upload me-2"></i>Upload Test Result
                                    </button>
                                </form>
                            </div>
                            
                            <div class="col-md-6">
                                <h6>Test Student Results View</h6>
                                <div class="mb-3">
                                    <label class="form-label">Student ID to View</label>
                                    <input type="text" class="form-control" id="viewStudentId" value="STU001">
                                </div>
                                <button type="button" class="btn btn-info mb-3" onclick="viewTestResults()">
                                    <i class="fas fa-eye me-2"></i>View Results
                                </button>
                                <button type="button" class="btn btn-success mb-3" onclick="exportTestResults()">
                                    <i class="fas fa-download me-2"></i>Export Results
                                </button>
                                <button type="button" class="btn btn-warning mb-3" onclick="calculateTestGPA()">
                                    <i class="fas fa-calculator me-2"></i>Calculate GPA
                                </button>
                                
                                <div id="testResultsDisplay" class="mt-3">
                                    <!-- Results will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>Test Results Log</h5>
                    </div>
                    <div class="card-body">
                        <div id="testLog" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;">
                            <p class="text-muted">Test log will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/result-management.js"></script>
    <script>
        // Test functions
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div><small class="text-muted">[${timestamp}]</small> ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function viewTestResults() {
            const studentId = document.getElementById('viewStudentId').value;
            const results = window.resultManager.getStudentResults(studentId);
            
            if (results) {
                const cgpa = window.resultManager.calculateCGPA(studentId);
                const display = document.getElementById('testResultsDisplay');
                
                let html = `
                    <div class="alert alert-info">
                        <h6>Results for ${results.name} (${studentId})</h6>
                        <p><strong>CGPA:</strong> ${cgpa.toFixed(2)}</p>
                        <p><strong>Department:</strong> ${results.department}</p>
                        <p><strong>Level:</strong> ${results.level}</p>
                    </div>
                `;
                
                Object.entries(results.semesters).forEach(([semester, semesterData]) => {
                    html += `
                        <div class="mb-2">
                            <strong>${semester}:</strong> GPA ${semesterData.gpa.toFixed(2)} (${semesterData.totalUnits} units)
                        </div>
                    `;
                });
                
                display.innerHTML = html;
                log(`Viewed results for student ${studentId}`);
            } else {
                document.getElementById('testResultsDisplay').innerHTML = 
                    '<div class="alert alert-warning">No results found for this student</div>';
                log(`No results found for student ${studentId}`);
            }
        }

        function exportTestResults() {
            const studentId = document.getElementById('viewStudentId').value;
            const csvContent = window.resultManager.exportResultsToCSV(studentId);
            window.resultManager.downloadCSV(csvContent, `test_results_${studentId}.csv`);
            log(`Exported results for student ${studentId}`);
        }

        function calculateTestGPA() {
            const studentId = document.getElementById('viewStudentId').value;
            const cgpa = window.resultManager.calculateCGPA(studentId);
            log(`Calculated CGPA for ${studentId}: ${cgpa.toFixed(2)}`);
            
            const display = document.getElementById('testResultsDisplay');
            display.innerHTML = `
                <div class="alert alert-success">
                    <h6>GPA Calculation</h6>
                    <p><strong>Student:</strong> ${studentId}</p>
                    <p><strong>CGPA:</strong> ${cgpa.toFixed(2)}</p>
                </div>
            `;
        }

        // Handle test form submission
        document.getElementById('testResultForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const resultData = {
                studentId: document.getElementById('testStudentId').value,
                studentName: document.getElementById('testStudentName').value,
                courseCode: document.getElementById('testCourseCode').value,
                courseTitle: document.getElementById('testCourseTitle').value,
                creditUnits: parseFloat(document.getElementById('testCreditUnits').value),
                score: parseFloat(document.getElementById('testScore').value),
                semester: document.getElementById('testSemester').value,
                lecturer: document.getElementById('testLecturer').value
            };
            
            window.resultManager.processResult(resultData);
            log(`Uploaded result: ${resultData.courseCode} - ${resultData.score}% for ${resultData.studentId}`);
            
            // Reset form
            this.reset();
            document.getElementById('testStudentId').value = 'STU001';
            document.getElementById('testStudentName').value = 'Alice Johnson';
            document.getElementById('testCourseCode').value = 'CSC101';
            document.getElementById('testCourseTitle').value = 'Introduction to Computer Science';
            document.getElementById('testCreditUnits').value = '3';
            document.getElementById('testScore').value = '85';
            document.getElementById('testSemester').value = '2024/1';
            document.getElementById('testLecturer').value = 'Dr. John Smith';
        });

        // Initialize test
        log('Result management test page loaded');
        log('Sample data loaded for STU001, STU002');
    </script>
</body>
</html> 